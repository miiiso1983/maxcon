# تعليمات الإعداد - نظام إدارة الصيدلية متعدد المستأجرين

## 🚀 خطوات الإعداد السريع

### 1. تشغيل المايجريشن
```bash
php artisan migrate
```

### 2. تشغيل السيدر لإعداد النظام
```bash
php artisan db:seed --class=MultiTenantSystemSeeder
```

### 3. ربط مجلد التخزين
```bash
php artisan storage:link
```

### 4. تحديث الصلاحيات (Linux/Mac)
```bash
chmod -R 755 storage
chmod -R 755 bootstrap/cache
```

### 5. تشغيل الخادم
```bash
php artisan serve
```

## 🔑 بيانات تسجيل الدخول

### لوحة التحكم الرئيسية (Super Admin)
- **الرابط:** http://localhost:8000/admin/login
- **البريد الإلكتروني:** superadmin@pharmacy-erp.com
- **كلمة المرور:** SuperAdmin@2024

### حسابات إضافية
- **أدمن مساعد:** admin@pharmacy-erp.com / Admin@2024
- **دعم فني:** support@pharmacy-erp.com / Support@2024

### مستأجرين تجريبيين
- **صيدلية النور:** ahmed@alnoor-pharmacy.com / Manager@2024
- **صيدلية الشفاء:** fatima@alshifa-pharmacy.com / Manager@2024

## 📋 ما تم إنشاؤه

### 1. قاعدة البيانات
- ✅ جداول المستأجرين والمستخدمين
- ✅ جداول التراخيص والصلاحيات
- ✅ جداول سجلات التدقيق
- ✅ إضافة tenant_id لجميع الجداول الموجودة

### 2. النماذج (Models)
- ✅ `Tenant` - إدارة المستأجرين
- ✅ `TenantUser` - مستخدمو المستأجرين
- ✅ `SuperAdmin` - السوبر أدمن
- ✅ `License` - التراخيص
- ✅ `AdminAuditLog` - سجلات التدقيق

### 3. الخدمات (Services)
- ✅ `TenantManager` - إدارة المستأجرين
- ✅ `TenantDeletionService` - حذف آمن للمستأجرين
- ✅ `TwoFactorAuthService` - المصادقة الثنائية
- ✅ `PasswordPolicyService` - سياسات كلمة المرور
- ✅ `SecurityMonitoringService` - مراقبة الأمان

### 4. Middleware
- ✅ `SuperAdminAuth` - مصادقة السوبر أدمن
- ✅ `SuperAdminPermission` - صلاحيات السوبر أدمن
- ✅ `TenantScope` - نطاق المستأجر
- ✅ `EnsureTenantDataIsolation` - عزل البيانات

### 5. Traits
- ✅ `TenantScoped` - تطبيق نطاق المستأجر تلقائياً

### 6. Controllers
- ✅ `DashboardController` - لوحة التحكم الرئيسية
- ✅ `TenantController` - إدارة المستأجرين
- ✅ `LicenseController` - إدارة التراخيص
- ✅ `SuperAdminController` - إدارة السوبر أدمن
- ✅ `AuditLogController` - سجلات التدقيق
- ✅ `AuthController` - المصادقة

### 7. Views
- ✅ صفحة تسجيل دخول السوبر أدمن
- ✅ لوحة التحكم الرئيسية
- ✅ تخطيط أساسي للوحة التحكم

### 8. Routes
- ✅ مسارات لوحة التحكم الرئيسية
- ✅ مسارات إدارة المستأجرين
- ✅ مسارات إدارة التراخيص
- ✅ مسارات سجلات التدقيق

## 🎯 المميزات المُفعلة

### إدارة المستأجرين
- ✅ إنشاء وتعديل وحذف المستأجرين
- ✅ تعليق وإلغاء تعليق المستأجرين
- ✅ تجديد التراخيص
- ✅ مراقبة الاستخدام والحدود

### نظام الترخيص
- ✅ 4 أنواع تراخيص (تجريبي، أساسي، احترافي، مؤسسي)
- ✅ تحديد حدود المستخدمين والتخزين
- ✅ مميزات قابلة للتخصيص
- ✅ تتبع انتهاء التراخيص

### الأمان
- ✅ مصادقة ثنائية (2FA)
- ✅ سياسات كلمة مرور متقدمة
- ✅ مراقبة الأنشطة المشبوهة
- ✅ سجل تدقيق شامل
- ✅ حظر IP تلقائي

### عزل البيانات
- ✅ عزل كامل بين المستأجرين
- ✅ تطبيق نطاق المستأجر تلقائياً
- ✅ منع الوصول للبيانات غير المصرح بها
- ✅ حذف آمن مع نسخ احتياطية

## 🔧 إعدادات إضافية (اختيارية)

### تفعيل المصادقة الثنائية
1. تثبيت مكتبة Google2FA:
```bash
composer require pragmarx/google2fa
```

2. تفعيل المصادقة الثنائية للسوبر أدمن من لوحة التحكم

### إعداد البريد الإلكتروني
1. تحديث إعدادات البريد في `.env`:
```env
MAIL_MAILER=smtp
MAIL_HOST=your-smtp-host
MAIL_PORT=587
MAIL_USERNAME=your-email
MAIL_PASSWORD=your-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@pharmacy-erp.com
MAIL_FROM_NAME="Pharmacy ERP System"
```

### إعداد Queue للمهام الخلفية
```bash
php artisan queue:work
```

### إعداد Scheduler للمهام المجدولة
إضافة إلى crontab:
```bash
* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1
```

## 📊 لوحة التحكم الرئيسية

### الإحصائيات المتاحة
- ✅ إجمالي المستأجرين والمستخدمين
- ✅ الإيرادات الشهرية والنمو
- ✅ استخدام التخزين والموارد
- ✅ التراخيص المنتهية قريباً
- ✅ أحدث الأنشطة والمستأجرين

### التقارير والرسوم البيانية
- ✅ رسم بياني للمستأجرين الجدد
- ✅ توزيع أنواع التراخيص
- ✅ إحصائيات تسجيل الدخول
- ✅ تقارير الإيرادات

## 🛡️ الأمان والمراقبة

### سجلات التدقيق
- ✅ تسجيل جميع عمليات السوبر أدمن
- ✅ تتبع تغييرات البيانات
- ✅ مراقبة محاولات تسجيل الدخول
- ✅ تصدير السجلات بصيغ متعددة

### مراقبة الأمان
- ✅ كشف محاولات تسجيل الدخول المشبوهة
- ✅ حظر IP تلقائي
- ✅ تنبيهات الأمان
- ✅ مراقبة الأنشطة غير العادية

## 🔄 العمليات الدورية

### تنظيف البيانات القديمة
```bash
# حذف سجلات التدقيق الأقدم من 6 أشهر
php artisan app:cleanup-audit-logs --months=6
```

### تحديث إحصائيات المستأجرين
```bash
php artisan app:update-tenant-stats
```

### فحص التراخيص المنتهية
```bash
php artisan app:check-expired-licenses --notify
```

## 📞 الدعم والمساعدة

### في حالة وجود مشاكل
1. تحقق من ملفات السجل في `storage/logs/`
2. تأكد من صحة إعدادات قاعدة البيانات
3. تحقق من صلاحيات المجلدات
4. راجع سجلات التدقيق للأنشطة المشبوهة

### الحصول على المساعدة
- **البريد الإلكتروني:** support@pharmacy-erp.com
- **الهاتف:** +966501234569

## ⚠️ تنبيهات مهمة

1. **غيّر كلمات المرور الافتراضية فوراً**
2. **فعّل المصادقة الثنائية لجميع حسابات السوبر أدمن**
3. **أجرِ نسخة احتياطية من قاعدة البيانات قبل التشغيل في الإنتاج**
4. **راقب سجلات الأمان بانتظام**
5. **حدّث النظام بانتظام للحصول على آخر التحديثات الأمنية**

---

**🎉 تهانينا! تم إعداد نظام إدارة الصيدلية متعدد المستأجرين بنجاح**

يمكنك الآن الوصول إلى لوحة التحكم الرئيسية وبدء إدارة المستأجرين والتراخيص.
